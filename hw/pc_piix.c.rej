--- hw/pc_piix.c
+++ hw/pc_piix.c
@@ -99,13 +105,25 @@ static void pc_init1(ram_addr_t ram_size,
                    &below_4g_mem_size, &above_4g_mem_size);
 
     cpu_irq = pc_allocate_cpu_irq();
-    i8259 = i8259_init(cpu_irq[0]);
-    isa_irq_state = qemu_mallocz(sizeof(*isa_irq_state));
-    isa_irq_state->i8259 = i8259;
-    if (pci_enabled) {
-        ioapic_init(isa_irq_state);
+#ifdef KVM_CAP_IRQCHIP
+    if (kvm_enabled() && kvm_irqchip_in_kernel()) {
+        isa_irq_state = qemu_mallocz(sizeof(*isa_irq_state));
+        if (pci_enabled) {
+            ioapic_init(isa_irq_state);
+        }
+        isa_irq = i8259 = kvm_i8259_init(cpu_irq[0]);
+        ioapic_irq_hack = isa_irq;
+    } else
+#endif
+    {
+        i8259 = i8259_init(cpu_irq[0]);
+        isa_irq_state = qemu_mallocz(sizeof(*isa_irq_state));
+        isa_irq_state->i8259 = i8259;
+        if (pci_enabled) {
+            ioapic_init(isa_irq_state);
+        }
+        isa_irq = qemu_allocate_irqs(isa_irq_handler, isa_irq_state, 24);
     }
-    isa_irq = qemu_allocate_irqs(isa_irq_handler, isa_irq_state, 24);
 
     if (pci_enabled) {
         pci_bus = i440fx_init(&i440fx_state, &piix3_devfn, isa_irq, ram_size);
